<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Artifex" name="author" />
<meta content="PyMuPDF is a high-performance Python library for data extraction, analysis, conversion &amp; manipulation of PDF (and other) documents." name="description" />
<meta content="PDF Text Extraction, PDF Image Extraction, PDF Conversion, PDF Tables, PDF Splitting, PDF Creation, Pyodide, PyScript" name="keywords" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JZTN4VTL9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-JZTN4VTL9M');
    </script>
    <link rel="author" title="About these documents" href="about.html" /><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="TextPage" href="textpage.html" /><link rel="prev" title="Shape" href="shape.html" />

    <link rel="shortcut icon" href="_static/PyMuPDF.ico"/><!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Story - PyMuPDF 1.25.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=74643500" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">PyMuPDF 1.25.3 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/sidebar-logo-dark.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/sidebar-logo-light.svg" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PyMuPDF 1.25.3 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">Features Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#performance">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html#license-and-copyright">License and Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymupdf4llm/index.html">PyMuPDF4LLM</a></li>
<li class="toctree-l1"><a class="reference internal" href="pymupdf-pro.html">PyMuPDF Pro</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="the-basics.html">The Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="rag.html">PyMuPDF, LLM &amp; RAG</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How to Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how-to-open-a-file.html">Opening Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-images.html">Images</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-annotations.html">Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-drawing-and-graphics.html">Drawing and Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-stories.html">Stories</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-journalling.html">Journalling</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-multiprocessing.html">Multiprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-ocr.html">OCR - Optical Character Recognition</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-optional-content.html">Optional Content Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-low-level-interfaces.html">Low-Level Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes-common-issues-and-their-solutions.html">Common Issues and their Solutions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="module.html">Command line interface</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="classes.html">Classes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="annot.html">Annot</a></li>
<li class="toctree-l2"><a class="reference internal" href="archive-class.html">Archive</a></li>
<li class="toctree-l2"><a class="reference internal" href="colorspace.html">Colorspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="displaylist.html">DisplayList</a></li>
<li class="toctree-l2"><a class="reference internal" href="document.html">Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="document-writer-class.html">DocumentWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="font.html">Font</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity.html">Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="irect.html">IRect</a></li>
<li class="toctree-l2"><a class="reference internal" href="link.html">Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="linkdest.html">linkDest</a></li>
<li class="toctree-l2"><a class="reference internal" href="matrix.html">Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="outline.html">Outline</a></li>
<li class="toctree-l2"><a class="reference internal" href="page.html">Page</a></li>
<li class="toctree-l2"><a class="reference internal" href="pixmap.html">Pixmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="point.html">Point</a></li>
<li class="toctree-l2"><a class="reference internal" href="quad.html">Quad</a></li>
<li class="toctree-l2"><a class="reference internal" href="rect.html">Rect</a></li>
<li class="toctree-l2"><a class="reference internal" href="shape.html">Shape</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Story</a></li>
<li class="toctree-l2"><a class="reference internal" href="textpage.html">TextPage</a></li>
<li class="toctree-l2"><a class="reference internal" href="textwriter.html">TextWriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="widget.html">Widget</a></li>
<li class="toctree-l2"><a class="reference internal" href="xml-class.html">Xml</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="algebra.html">Operator Algebra for Geometry Objects</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="lowlevel.html">Low Level Functions and Classes</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Low Level Functions and Classes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="device.html">Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="coop_low.html">Working together: DisplayList and TextPage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="vars.html">Constants and Enumerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="colors.html">Color Database</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="app1.html">Appendix 1: Details on Text Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="app2.html">Appendix 2: Considerations on Embedded Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="app3.html">Appendix 3: Assorted Technical Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="app4.html">Appendix 4: Performance Comparison Methodology</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="znames.html">Deprecated Names</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/story-class.rst" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <style>

    #languageToggle {
        width:25%;
        margin:8px 10px 0;
    }

    #button-select-en {
        padding: 5px 10px;
        background-color: #fff;
        border: 1px solid #000;
        border-radius: 10px 0 0 10px;
        font-size: 14px;
    }

    #button-select-ja {
        padding: 5px 10px;
        background-color: #fff;
        border: 1px solid #000;
        border-radius: 0px 10px 10px 0;
        border-left: 0;
        font-size: 14px;
    }

    #button-select-en , #button-select-ja, #button-select-en:hover , #button-select-ja:hover  {
        color: #fff;
        text-decoration: none;
    }

    /* small screens */
    @media all and (max-width : 768px)  {
        #languageToggle {
            width:50%;
        }
    }

    @media all and (max-width : 400px)  {
        #languageToggle {
            width:70%;
        }
    }

    @media all and (max-width : 375px)  {
        #button-select-en , #button-select-ja {
            font-size: 11px;
        }
    }

</style>

<div style="display:flex;justify-content:space-between;align-items: center;">
    <form class="sidebar-search-container top" method="get" action="search.html" role="search" style="width:75%">
      <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
      <input type="hidden" name="check_keywords" value="yes">
      <input type="hidden" name="area" value="default">
    </form>
    <div id="languageToggle"><span><a id="button-select-en" href="javaScript:changeLanguage('en')">English</a></span><span><a id="button-select-ja" href="javaScript:changeLanguage('ja')">日本語</a></span></div>
</div>

<div style="display:flex;justify-content:space-between;align-items:center;margin-top:20px;">
    <div class="discordLink" style="display:flex;align-items:center;margin-top: -5px;">
        <a href="https://discord.gg/TSpYGBW4eq" id="findOnDiscord" target=_blank>Find <b>#pymupdf</b> on <b>Discord</b></a>
        <a href="https://discord.gg/TSpYGBW4eq" target=_blank>
            <div style="width:30px;height:30px;margin-left:5px;">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36">
                    <defs>
                        <style>.discordLogoFill{fill:#5865f2;}</style>
                    </defs>
                    <g id="Discord_Logo" data-name="Discord Logo">
                        <path class="discordLogoFill" d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
                    </g>
                </svg>
            </div>
        </a>
    </div>

    <div class="feedbackLink"><a id="feedbackLinkTop" target=_blank>Do you have any feedback on this page?</b></a></div>
</div>

<script>
    // highlightSelectedLanguage

    if (document.getElementsByTagName('html')[0].getAttribute('lang')=="ja") {
        document.getElementById("button-select-ja").style.backgroundColor = "#ff6600";
        document.getElementById("button-select-en").style.color = "#000";
    } else {
        document.getElementById("button-select-en").style.backgroundColor = "#ff6600";
        document.getElementById("button-select-ja").style.color = "#000";
    }


    var url_string = window.location.href;
    var a = document.getElementById('feedbackLinkTop');
    a.setAttribute("href", "https://artifex.com/contributor/feedback.php?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=header-link&url="+url_string);

    function changeLanguage(lang) {
        var new_url;

        if (lang == "en") {
            new_url = url_string.replace("/ja/", "/en/");
        } else {
            new_url = url_string.replace("/en/", "/ja/");
        }

        window.location.replace(new_url);
    }

</script><section id="story">
<span id="id1"></span><h1>Story<a class="headerlink" href="#story" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p>New in v1.21.0</p></li>
</ul>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Method / Attribute</strong></p></th>
<th class="head"><p><strong>Short Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#Story.reset" title="Story.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.reset()</span></code></a></p></td>
<td><p>“rewind” story output to its beginning</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Story.place" title="Story.place"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.place()</span></code></a></p></td>
<td><p>compute story content to fit in provided rectangle</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Story.draw" title="Story.draw"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.draw()</span></code></a></p></td>
<td><p>write the computed content to current page</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Story.element_positions" title="Story.element_positions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.element_positions()</span></code></a></p></td>
<td><p>callback function logging currently processed story content</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Story.body" title="Story.body"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Story.body</span></code></a></p></td>
<td><p>the story’s underlying <em class="htmltag">body</em></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Story.write" title="Story.write"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.write()</span></code></a></p></td>
<td><p>places and draws Story to a DocumentWriter</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Story.write_stabilized" title="Story.write_stabilized"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.write_stabilized()</span></code></a></p></td>
<td><p>iterative layout of html content to a DocumentWriter</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Story.write_with_links" title="Story.write_with_links"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.write_with_links()</span></code></a></p></td>
<td><p>like <a class="reference internal" href="#Story.write" title="Story.write"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a> but also creates PDF links</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Story.write_stabilized_with_links" title="Story.write_stabilized_with_links"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.write_stabilized_with_links()</span></code></a></p></td>
<td><p>like <a class="reference internal" href="#Story.write_stabilized" title="Story.write_stabilized"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">write_stabilized()</span></code></a> but also creates PDF links</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Story.fit" title="Story.fit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.fit()</span></code></a></p></td>
<td><p>Finds optimal rect that contains the story <code class="xref any docutils literal notranslate"><span class="pre">self</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Story.fit_scale" title="Story.fit_scale"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.fit_scale()</span></code></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#Story.fit_height" title="Story.fit_height"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.fit_height()</span></code></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#Story.fit_width" title="Story.fit_width"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.fit_width()</span></code></a></p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Class API</strong></p>
<dl class="py class">
<dt class="sig sig-object py" id="Story">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Story</span></span><a class="headerlink" href="#Story" title="Link to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="Story.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">html</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_css</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">em</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">12</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">archive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.__init__" title="Link to this definition">¶</a></dt>
<dd><p>Create a <strong>story</strong>, optionally providing HTML and CSS source.
The HTML is parsed, and held within the Story as a DOM (Document Object Model).</p>
<p>This structure may be modified: content (text, images) may be added,
copied, modified or removed by using methods of the <a class="reference internal" href="xml-class.html#xml"><span class="std std-ref">Xml</span></a> class.</p>
<p>When finished, the <strong>story</strong> can be written to any device;
in typical usage the device may be provided by a <a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a> to make new pages.</p>
<p>Here are some general remarks:</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="#story"><span class="std std-ref">Story</span></a> constructor parses and validates the provided HTML to create the DOM.</p></li>
<li><p>PyMuPDF provides a number of ways to manipulate the HTML source by
providing access to the <em>nodes</em> of the underlying DOM.
Documents can be completely built from ground up programmatically,
or the existing DOM can be modified pretty arbitrarily.
For details of this interface, please see the <a class="reference internal" href="xml-class.html#xml"><span class="std std-ref">Xml</span></a> class.</p></li>
<li><p>If no (or no more) changes to the DOM are required,
the story is ready to be laid out and to be fed to a series of devices
(typically devices provided by a <a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a> to produce new pages).</p></li>
<li><p>The next step is to place the story and write it out.
This can either be done directly, by looping around calling <a class="reference internal" href="#Story.place" title="Story.place"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">place()</span></code></a> and <a class="reference internal" href="#Story.draw" title="Story.draw"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">draw()</span></code></a>,
or alternatively,
the looping can handled for you using the <a class="reference internal" href="#Story.write" title="Story.write"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a> or <code class="xref any docutils literal notranslate"><span class="pre">write_stabilised()</span></code> methods.
Which method you choose is largely a matter of taste.</p>
<ul>
<li><p>To work in the first of these styles, the following loop should be used:</p>
<ol class="arabic simple">
<li><p>Obtain a suitable device to write to;
typically by requesting a new,
empty page from a <a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a>.</p></li>
<li><p>Determine one or more rectangles on the page,
that should receive <strong>story</strong> data.
Note that not every page needs to have the same set of rectangles.</p></li>
<li><p>Pass each rectangle to the <strong>story</strong> to place it,
learning what part of that rectangle has been filled,
and whether there is more story data that did not fit.
This step can be repeated several times with adjusted rectangles
until the caller is happy with the results.</p></li>
<li><p>Optionally, at this point,
we can request details of where interesting items have been placed,
by calling the <a class="reference internal" href="#Story.element_positions" title="Story.element_positions"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">element_positions()</span></code></a> method.
Items are deemed to be interesting if their integer <code class="xref any docutils literal notranslate"><span class="pre">heading</span></code> attribute is a non-zero
(corresponding to HTML tags <em class="htmltag">h1</em> - <em class="htmltag">h6</em>),
if their <code class="xref any docutils literal notranslate"><span class="pre">id</span></code> attribute is not <code class="xref any docutils literal notranslate"><span class="pre">None</span></code> (corresponding to HTML tag <em class="htmltag">id</em>),
or if their <code class="xref any docutils literal notranslate"><span class="pre">href</span></code> attribute is not <code class="xref any docutils literal notranslate"><span class="pre">None</span></code> (responding to HTML tag <em class="htmltag">href</em>).
This can conveniently be used for automatic generation of a Table of Contents,
an index of images or the like.</p></li>
<li><p>Next, draw that rectangle out to the device with the <a class="reference internal" href="#Story.draw" title="Story.draw"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">draw()</span></code></a> method.</p></li>
<li><p>If the most recent call to <a class="reference internal" href="#Story.place" title="Story.place"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">place()</span></code></a> indicated that all the story data had fitted,
stop now.</p></li>
<li><p>Otherwise, we can loop back.
If there are more rectangles to be placed on the current device (page),
we jump back to step 3 - if not, we jump back to step 1 to get a new device.</p></li>
</ol>
</li>
<li><p>Alternatively, in the case where you are using a <a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a>,
the <a class="reference internal" href="#Story.write" title="Story.write"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a> or <a class="reference internal" href="#Story.write_stabilized" title="Story.write_stabilized"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">write_stabilized()</span></code></a> methods can be used.
These handle all the looping for you,
in exchange for being provided with callbacks that control the behaviour
(notably a callback that enumerates the rectangles/pages to use).</p></li>
</ul>
</li>
<li><p>Which part of the <strong>story</strong> will land on which rectangle / which page,
is fully under control of the <a class="reference internal" href="#story"><span class="std std-ref">Story</span></a> object and cannot be predicted.</p></li>
<li><p>Images may be part of a <strong>story</strong>. They will be placed together with any surrounding text.</p></li>
<li><p>Multiple stories may - independently from each other - write to the same page.
For example, one may have separate stories for page header,
page footer, regular text, comment boxes, etc.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>html</strong> (<em>str</em>) – HTML source code. If omitted, a basic minimum is generated (see below).
If provided, not a complete HTML document is needed.
The in-built source parser will forgive (many / most)
HTML syntax errors and also accepts HTML fragments like
<code class="xref any docutils literal notranslate"><span class="pre">&quot;&lt;b&gt;Hello,</span> <span class="pre">&lt;i&gt;World!&lt;/i&gt;&lt;/b&gt;&quot;</span></code>.</p></li>
<li><p><strong>user_css</strong> (<em>str</em>) – CSS source code. If provided, must contain valid CSS specifications.</p></li>
<li><p><strong>em</strong> (<em>float</em>) – the default text font size.</p></li>
<li><p><strong>archive</strong> – <p>an <a class="reference internal" href="archive-class.html#archive"><span class="std std-ref">Archive</span></a> from which to load resources for rendering. Currently supported resource types are images and text fonts. If omitted, the story will not try to look up any such data and may thus produce incomplete output.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Instead of an actual archive, valid arguments for <strong>creating</strong> an <a class="reference internal" href="archive-class.html#archive"><span class="std std-ref">Archive</span></a> can also be provided – in which case an archive will temporarily be constructed. So, instead of <code class="xref any docutils literal notranslate"><span class="pre">story</span> <span class="pre">=</span> <span class="pre">pymupdf.Story(archive=pymupdf.Archive(&quot;myfolder&quot;))</span></code>, one can also shorter write <code class="xref any docutils literal notranslate"><span class="pre">story</span> <span class="pre">=</span> <span class="pre">pymupdf.Story(archive=&quot;myfolder&quot;)</span></code>.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.place">
<span class="sig-name descname"><span class="pre">place</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">where</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.place" title="Link to this definition">¶</a></dt>
<dd><p>Calculate that part of the story’s content, that will fit in the provided rectangle. The method maintains a pointer which part of the story’s content has already been written and upon the next invocation resumes from that pointer’s position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>where</strong> (<em>rect_like</em>) – layout the current part of the content to fit into this rectangle. This must be a sub-rectangle of the page’s <a class="reference internal" href="glossary.html#glossary-mediabox"><span class="std std-ref">MediaBox</span></a>.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>tuple[bool, rect_like]</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>a bool (int) <code class="xref any docutils literal notranslate"><span class="pre">more</span></code> and a rectangle <code class="xref any docutils literal notranslate"><span class="pre">filled</span></code>. If <code class="xref any docutils literal notranslate"><span class="pre">more</span> <span class="pre">==</span> <span class="pre">0</span></code>, all content of the story has been written, otherwise more is waiting to be written to subsequent rectangles / pages. Rectangle <code class="xref any docutils literal notranslate"><span class="pre">filled</span></code> is the part of <code class="xref any docutils literal notranslate"><span class="pre">where</span></code> that has actually been filled.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.draw">
<span class="sig-name descname"><span class="pre">draw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dev</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matrix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.draw" title="Link to this definition">¶</a></dt>
<dd><p>Write the content part prepared by <a class="reference internal" href="#Story.place" title="Story.place"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.place()</span></code></a> to the page.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dev</strong> – the <a class="reference internal" href="device.html#device"><span class="std std-ref">Device</span></a> created by <code class="xref any docutils literal notranslate"><span class="pre">dev</span> <span class="pre">=</span> <span class="pre">writer.begin_page(mediabox)</span></code>. The device knows how to call all MuPDF functions needed to write the content.</p></li>
<li><p><strong>matrix</strong> (<em>matrix_like</em>) – a matrix for transforming content when writing to the page. An example may be writing rotated text. The default means no transformation (i.e. the <a class="reference internal" href="identity.html#identity"><span class="std std-ref">Identity</span></a> matrix).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.element_positions">
<span class="sig-name descname"><span class="pre">element_positions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">function</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.element_positions" title="Link to this definition">¶</a></dt>
<dd><p>Let the Story provide positioning information about certain HTML elements once their place on the current page has been computed - i.e. invoke this method <strong>directly after</strong> <a class="reference internal" href="#Story.place" title="Story.place"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.place()</span></code></a>.</p>
<p><em>Story</em> will pass position information to <em>function</em>. This information can for example be used to generate a Table of Contents.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>function</strong> (<em>callable</em>) – a Python function accepting an <code class="xref py py-class docutils literal notranslate"><span class="pre">ElementPosition</span></code> object. It will be invoked by the Story object to process positioning information. The function <strong>must</strong> be a callable accepting exactly one argument.</p></li>
<li><p><strong>args</strong> (<em>dict</em>) – an optional dictionary with any <strong>additional</strong> information
that should be added to the <code class="xref py py-class docutils literal notranslate"><span class="pre">ElementPosition</span></code> instance passed to <code class="xref any docutils literal notranslate"><span class="pre">function</span></code>.
Like for example the current output page number.
Every key in this dictionary must be a string that conforms to the rules for a valid Python identifier.
The complete set of information is explained below.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Story.reset" title="Link to this definition">¶</a></dt>
<dd><p>Rewind the story’s document to the beginning for starting over its output.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Story.body">
<span class="sig-name descname"><span class="pre">body</span></span><a class="headerlink" href="#Story.body" title="Link to this definition">¶</a></dt>
<dd><p>The <em class="htmltag">body</em> part of the story’s DOM. This attribute contains the <a class="reference internal" href="xml-class.html#xml"><span class="std std-ref">Xml</span></a> node of <em class="htmltag">body</em>. All relevant content for PDF production is contained between “&lt;body&gt;” and “&lt;/body&gt;”.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.write">
<span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">writer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rectfn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positionfn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pagefn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.write" title="Link to this definition">¶</a></dt>
<dd><p>Places and draws Story to a <a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a>. Avoids the need for
calling code to implement a loop that calls <a class="reference internal" href="#Story.place" title="Story.place"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">Story.place()</span></code></a> and
<a class="reference internal" href="#Story.draw" title="Story.draw"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">Story.draw()</span></code></a> etc, at the expense of having to provide at least the
<code class="xref any docutils literal notranslate"><span class="pre">rectfn()</span></code> callback.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>writer</strong> – a <a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a> or None.</p></li>
<li><p><strong>rectfn</strong> – <p>a callable taking <code class="xref any docutils literal notranslate"><span class="pre">(rect_num:</span> <span class="pre">int,</span> <span class="pre">filled:</span> <span class="pre">Rect)</span></code> and
returning <code class="xref any docutils literal notranslate"><span class="pre">(mediabox,</span> <span class="pre">rect,</span> <span class="pre">ctm)</span></code>:</p>
<ul>
<li><p>mediabox: None or rect for new page.</p></li>
<li><p>rect: The next rect into which content should be placed.</p></li>
<li><p>ctm: None or a <a class="reference internal" href="matrix.html#matrix"><span class="std std-ref">Matrix</span></a>.</p></li>
</ul>
</p></li>
<li><p><strong>positionfn</strong> – <p>None, or a callable taking <code class="xref any docutils literal notranslate"><span class="pre">(position:</span> <span class="pre">ElementPosition)</span></code>:</p>
<ul>
<li><dl class="simple">
<dt>position:</dt><dd><p>An <code class="xref any docutils literal notranslate"><span class="pre">ElementPosition</span></code> with an extra <code class="xref any docutils literal notranslate"><span class="pre">.page_num</span></code> member.</p>
</dd>
</dl>
</li>
</ul>
<p>Typically called multiple times as we generate elements that
are headings or have an id.</p>
</p></li>
<li><p><strong>pagefn</strong> – None, or a callable taking <code class="xref any docutils literal notranslate"><span class="pre">(page_num,</span> <span class="pre">mediabox,</span> <span class="pre">dev,</span> <span class="pre">after)</span></code>;
called at start (<code class="xref any docutils literal notranslate"><span class="pre">after=0</span></code>) and end (<code class="xref any docutils literal notranslate"><span class="pre">after=1</span></code>) of each page.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.write_stabilized">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">write_stabilized</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">writer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contentfn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rectfn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_css</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">em</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">12</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positionfn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pagefn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">archive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_header_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.write_stabilized" title="Link to this definition">¶</a></dt>
<dd><p>Static method that does iterative layout of html content to a
<a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a>.</p>
<p>For example this allows one to add a table of contents section
while ensuring that page numbers are patched up until stable.</p>
<p>Repeatedly creates a new <a class="reference internal" href="#story"><span class="std std-ref">Story</span></a> from <code class="xref any docutils literal notranslate"><span class="pre">(contentfn(),</span>
<span class="pre">user_css,</span> <span class="pre">em,</span> <span class="pre">archive)</span></code> and lays it out with internal call
to <a class="reference internal" href="#Story.write" title="Story.write"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">Story.write()</span></code></a>; uses a None writer and extracts the list
of <code class="xref any docutils literal notranslate"><span class="pre">ElementPosition</span></code>’s which is passed to the next call of
<code class="xref any docutils literal notranslate"><span class="pre">contentfn()</span></code>.</p>
<p>When the html from <code class="xref any docutils literal notranslate"><span class="pre">contentfn()</span></code> becomes unchanged, we do a
final iteration using <code class="xref any docutils literal notranslate"><span class="pre">writer</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>writer</strong> – A <a class="reference internal" href="document-writer-class.html#documentwriter"><span class="std std-ref">DocumentWriter</span></a>.</p></li>
<li><p><strong>contentfn</strong> – A function taking a list of <code class="xref any docutils literal notranslate"><span class="pre">ElementPositions</span></code> and
returning a string containing html. The returned html
can depend on the list of positions, for example with a
table of contents near the start.</p></li>
<li><p><strong>rectfn</strong> – <p>A callable taking <code class="xref any docutils literal notranslate"><span class="pre">(rect_num:</span> <span class="pre">int,</span> <span class="pre">filled:</span> <span class="pre">Rect)</span></code> and
returning <code class="xref any docutils literal notranslate"><span class="pre">(mediabox,</span> <span class="pre">rect,</span> <span class="pre">ctm)</span></code>:</p>
<ul>
<li><p>mediabox: None or rect for new page.</p></li>
<li><p>rect: The next rect into which content should be placed.</p></li>
<li><p>ctm: A <a class="reference internal" href="matrix.html#matrix"><span class="std std-ref">Matrix</span></a>.</p></li>
</ul>
</p></li>
<li><p><strong>pagefn</strong> – None, or a callable taking <code class="xref any docutils literal notranslate"><span class="pre">(page_num,</span> <span class="pre">medibox,</span>
<span class="pre">dev,</span> <span class="pre">after)</span></code>; called at start (<code class="xref any docutils literal notranslate"><span class="pre">after=0</span></code>) and end
(<code class="xref any docutils literal notranslate"><span class="pre">after=1</span></code>) of each page.</p></li>
<li><p><strong>archive</strong></p></li>
<li><p><strong>add_header_ids</strong> – If true, we add unique ids to all header tags that
don’t already have an id. This can help automatic
generation of tables of contents.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Returns:</dt><dd><p>None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.write_with_links">
<span class="sig-name descname"><span class="pre">write_with_links</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rectfn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positionfn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pagefn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.write_with_links" title="Link to this definition">¶</a></dt>
<dd><p>Similar to <a class="reference internal" href="#Story.write" title="Story.write"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">write()</span></code></a> except that we don’t have a <code class="xref any docutils literal notranslate"><span class="pre">writer</span></code> arg
and we return a PDF <a class="reference internal" href="document.html#document"><span class="std std-ref">Document</span></a> in which links have been created
for each internal html link.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.write_stabilized_with_links">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">write_stabilized_with_links</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contentfn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rectfn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_css</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">em</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">12</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positionfn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pagefn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">archive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_header_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.write_stabilized_with_links" title="Link to this definition">¶</a></dt>
<dd><p>Similar to <a class="reference internal" href="#Story.write_stabilized" title="Story.write_stabilized"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">write_stabilized()</span></code></a> except that we don’t have a <code class="xref any docutils literal notranslate"><span class="pre">writer</span></code>
arg and instead return a PDF <a class="reference internal" href="document.html#document"><span class="std std-ref">Document</span></a> in which links have been
created for each internal html link.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Story.FitResult">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">FitResult</span></span><a class="headerlink" href="#Story.FitResult" title="Link to this definition">¶</a></dt>
<dd><p>The result from a <code class="xref any docutils literal notranslate"><span class="pre">Story.fit*()</span></code> method.</p>
<p>Members:</p>
<dl class="simple">
<dt><code class="xref any docutils literal notranslate"><span class="pre">big_enough</span></code>:</dt><dd><p><code class="xref any docutils literal notranslate"><span class="pre">True</span></code> if the fit succeeded.</p>
</dd>
<dt><code class="xref any docutils literal notranslate"><span class="pre">filled</span></code>:</dt><dd><p>From the last call to <a class="reference internal" href="#Story.place" title="Story.place"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">Story.place()</span></code></a>.</p>
</dd>
<dt><code class="xref any docutils literal notranslate"><span class="pre">more</span></code>:</dt><dd><p><code class="xref any docutils literal notranslate"><span class="pre">False</span></code> if the fit succeeded.</p>
</dd>
<dt><code class="xref any docutils literal notranslate"><span class="pre">numcalls</span></code>:</dt><dd><p>Number of calls made to <code class="xref any docutils literal notranslate"><span class="pre">self.place()</span></code>.</p>
</dd>
<dt><code class="xref any docutils literal notranslate"><span class="pre">parameter</span></code>:</dt><dd><p>The successful parameter value, or the largest failing value.</p>
</dd>
<dt><a class="reference internal" href="rect.html"><span class="doc">Rect</span></a>:</dt><dd><p>The rect created from <code class="xref any docutils literal notranslate"><span class="pre">parameter</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.fit" title="Link to this definition">¶</a></dt>
<dd><p>Finds optimal rect that contains the story <code class="xref any docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>Returns a <a class="reference internal" href="#Story.FitResult" title="Story.FitResult"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Story.FitResult</span></code></a> instance.</p>
<p>On success, the last call to <code class="xref any docutils literal notranslate"><span class="pre">self.place()</span></code> will have been with the
returned rectangle, so <code class="xref any docutils literal notranslate"><span class="pre">self.draw()</span></code> can be used directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> – <p>A callable taking a floating point <code class="xref any docutils literal notranslate"><span class="pre">parameter</span></code> and returning a
<code class="xref any docutils literal notranslate"><span class="pre">pymupdf.Rect()</span></code>. If the rect is empty, we assume the story will
not fit and do not call <code class="xref any docutils literal notranslate"><span class="pre">self.place()</span></code>.</p>
<p>Must guarantee that <code class="xref any docutils literal notranslate"><span class="pre">self.place()</span></code> behaves monotonically when
given rect <code class="xref any docutils literal notranslate"><span class="pre">fn(parameter</span></code>) as <code class="xref any docutils literal notranslate"><span class="pre">parameter</span></code> increases. This
usually means that both width and height increase or stay
unchanged as <code class="xref any docutils literal notranslate"><span class="pre">parameter</span></code> increases.</p>
</p></li>
<li><p><strong>pmin</strong> – Minimum parameter to consider; <code class="xref any docutils literal notranslate"><span class="pre">None</span></code> for -infinity.</p></li>
<li><p><strong>pmax</strong> – Maximum parameter to consider; <code class="xref any docutils literal notranslate"><span class="pre">None</span></code> for +infinity.</p></li>
<li><p><strong>delta</strong> – Maximum error in returned <code class="xref any docutils literal notranslate"><span class="pre">parameter</span></code>.</p></li>
<li><p><strong>verbose</strong> – If true we output diagnostics.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.fit_scale">
<span class="sig-name descname"><span class="pre">fit_scale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rect</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.fit_scale" title="Link to this definition">¶</a></dt>
<dd><p>Finds smallest value <code class="xref any docutils literal notranslate"><span class="pre">scale</span></code> in range <code class="xref any docutils literal notranslate"><span class="pre">scale_min..scale_max</span></code> where
<code class="xref any docutils literal notranslate"><span class="pre">scale</span> <span class="pre">*</span> <span class="pre">rect</span></code> is large enough to contain the story <code class="xref any docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>Returns a <a class="reference internal" href="#Story.FitResult" title="Story.FitResult"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Story.FitResult</span></code></a> instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>width</strong> – width of rect.</p></li>
<li><p><strong>height</strong> – height of rect.</p></li>
<li><p><strong>scale_min</strong> – Minimum scale to consider; must be &gt;= 0.</p></li>
<li><p><strong>scale_max</strong> – Maximum scale to consider, must be &gt;= scale_min or <code class="xref any docutils literal notranslate"><span class="pre">None</span></code> for
infinite.</p></li>
<li><p><strong>delta</strong> – Maximum error in returned scale.</p></li>
<li><p><strong>verbose</strong> – If true we output diagnostics.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.fit_height">
<span class="sig-name descname"><span class="pre">fit_height</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.fit_height" title="Link to this definition">¶</a></dt>
<dd><p>Finds smallest height in range <code class="xref any docutils literal notranslate"><span class="pre">height_min..height_max</span></code> where a rect
with size <code class="xref any docutils literal notranslate"><span class="pre">(width,</span> <span class="pre">height)</span></code> is large enough to contain the story
<code class="xref any docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>Returns a <a class="reference internal" href="#Story.FitResult" title="Story.FitResult"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Story.FitResult</span></code></a> instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>width</strong> – width of rect.</p></li>
<li><p><strong>height_min</strong> – Minimum height to consider; must be &gt;= 0.</p></li>
<li><p><strong>height_max</strong> – Maximum height to consider, must be &gt;= height_min or <code class="xref any docutils literal notranslate"><span class="pre">None</span></code> for
infinite.</p></li>
<li><p><strong>origin</strong> – <code class="xref any docutils literal notranslate"><span class="pre">(x0,</span> <span class="pre">y0)</span></code> of rect.</p></li>
<li><p><strong>delta</strong> – Maximum error in returned height.</p></li>
<li><p><strong>verbose</strong> – If true we output diagnostics.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Story.fit_width">
<span class="sig-name descname"><span class="pre">fit_width</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Story.fit_width" title="Link to this definition">¶</a></dt>
<dd><p>Finds smallest width in range <code class="xref any docutils literal notranslate"><span class="pre">width_min..width_max</span></code> where a rect with size
<code class="xref any docutils literal notranslate"><span class="pre">(width,</span> <span class="pre">height)</span></code> is large enough to contain the story <code class="xref any docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>Returns a <a class="reference internal" href="#Story.FitResult" title="Story.FitResult"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Story.FitResult</span></code></a> instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>height</strong> – height of rect.</p></li>
<li><p><strong>width_min</strong> – Minimum width to consider; must be &gt;= 0.</p></li>
<li><p><strong>width_max</strong> – Maximum width to consider, must be &gt;= width_min or <code class="xref any docutils literal notranslate"><span class="pre">None</span></code> for
infinite.</p></li>
<li><p><strong>origin</strong> – <code class="xref any docutils literal notranslate"><span class="pre">(x0,</span> <span class="pre">y0)</span></code> of rect.</p></li>
<li><p><strong>delta</strong> – Maximum error in returned width.</p></li>
<li><p><strong>verbose</strong> – If true we output diagnostics.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="element-positioning-callback-function">
<h2>Element Positioning CallBack function<a class="headerlink" href="#element-positioning-callback-function" title="Link to this heading">¶</a></h2>
<p>The callback function can be used to log information about story output. The function’s access to the information is read-only: it has no way to influence the story’s output.</p>
<p>A typical loop for executing a story with using this method would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">    &lt;head&gt;&lt;/head&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Header level 1&lt;/h1&gt;</span>
<span class="s2">        &lt;h2&gt;Header level 2&lt;/h2&gt;</span>
<span class="s2">        &lt;p&gt;Hello MuPDF!&lt;/p&gt;</span>
<span class="s2">    &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">MEDIABOX</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">paper_rect</span><span class="p">(</span><span class="s2">&quot;letter&quot;</span><span class="p">)</span>  <span class="c1"># size of a page</span>
<span class="n">WHERE</span> <span class="o">=</span> <span class="n">MEDIABOX</span> <span class="o">+</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">,</span> <span class="o">-</span><span class="mi">36</span><span class="p">)</span>  <span class="c1"># leave borders of 0.5 inches</span>
<span class="n">story</span> <span class="o">=</span>  <span class="n">pymupdf</span><span class="o">.</span><span class="n">Story</span><span class="p">(</span><span class="n">html</span><span class="o">=</span><span class="n">HTML</span><span class="p">)</span>  <span class="c1"># make the story</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">pymupdf</span><span class="o">.</span><span class="n">DocumentWriter</span><span class="p">(</span><span class="s2">&quot;test.pdf&quot;</span><span class="p">)</span>  <span class="c1"># make the writer</span>
<span class="n">pno</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># current page number</span>
<span class="n">more</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># will be set to 0 when done</span>
<span class="k">while</span> <span class="n">more</span><span class="p">:</span>  <span class="c1"># loop until all story content is processed</span>
    <span class="n">dev</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">begin_page</span><span class="p">(</span><span class="n">MEDIABOX</span><span class="p">)</span>  <span class="c1"># make a device to write on the page</span>
    <span class="n">more</span><span class="p">,</span> <span class="n">filled</span> <span class="o">=</span> <span class="n">story</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">WHERE</span><span class="p">)</span>  <span class="c1"># compute content positions on page</span>
    <span class="n">story</span><span class="o">.</span><span class="n">element_positions</span><span class="p">(</span><span class="n">recorder</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">pno</span><span class="p">})</span>  <span class="c1"># provide page number in addition</span>
    <span class="n">story</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">end_page</span><span class="p">()</span>
    <span class="n">pno</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># increase page number</span>
<span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># close output file</span>

<span class="k">def</span> <span class="nf">recorder</span><span class="p">(</span><span class="n">elpos</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<section id="attributes-of-the-elementposition-class">
<h3>Attributes of the ElementPosition class<a class="headerlink" href="#attributes-of-the-elementposition-class" title="Link to this heading">¶</a></h3>
<p>Exactly one parameter must be passed to the function provided by <a class="reference internal" href="#Story.element_positions" title="Story.element_positions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Story.element_positions()</span></code></a>. It is an object with the following attributes:</p>
<p>The parameter passed to the <code class="xref any docutils literal notranslate"><span class="pre">recorder</span></code> function is an object with the following attributes:</p>
<ul class="simple">
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.depth</span></code> (int) – depth of this element in the box structure.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.heading</span></code> (int) – the header level, 0 if no header, 1-6 for <em class="htmltag">h1</em> - <em class="htmltag">h6</em>.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.href</span></code> (str) – value of the <code class="xref any docutils literal notranslate"><span class="pre">href</span></code> attribute, or None if not defined.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.id</span></code> (str) – value of the <code class="xref any docutils literal notranslate"><span class="pre">id</span></code> attribute, or None if not defined.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.rect</span></code> (tuple) – element position on page.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.text</span></code> (str) – immediate text of the element.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.open_close</span></code> (int bit field) – bit 0 set: opens element, bit 1 set: closes element. Relevant for elements that may contain other elements and thus may not immediately be closed after being created / opened.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.rect_num</span></code> (int) – count of rectangles filled by the story so far.</p></li>
<li><p><code class="xref any docutils literal notranslate"><span class="pre">elpos.page_num</span></code> (int) – page number; only present when using <code class="xref any docutils literal notranslate"><span class="pre">pymupdf.Story.write*()</span></code> functions.</p></li>
</ul>
<div class="feedbackLink"><a id="feedbackLinkBottom" target=_blank>Do you have any feedback on this page?</b></a></div><hr class="docutils" />
<script>

   var url_string = window.location.href;
   var a = document.getElementById('feedbackLinkBottom');
   a.setAttribute("href", "https://artifex.com/contributor/feedback.php?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link&url="+url_string);

</script>

<p style="color:#999" id="footerDisclaimer">This software is provided AS-IS with no warranty, either express or implied. This software is distributed under license and may not be copied, modified or distributed except as expressly authorized under the terms of that license. Refer to licensing information at <a href="https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link">artifex.com</a> or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States for further information.</p>



<script>

   let docLanguage = document.getElementsByTagName('html')[0].getAttribute('lang');

   function getHeaderAndFooterTranslation(str) {
       if (docLanguage == "ja") {
           if (str == "Do you have any feedback on this page?") {
               return "このページに関するご意見はありますか？";
           } else if (str == "Find <b>#pymupdf</b> on <b>Discord</b>") {
               return "<b>Discord</b>の <b>#pymupdf</b> を見つける";
           } else if (str == "This software is provided AS-IS with no warranty, either express or implied. This software is distributed under license and may not be copied, modified or distributed except as expressly authorized under the terms of that license. Refer to licensing information at <a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a> or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States for further information.") {

               return "このソフトウェアは無保証で提供されており、明示または黙示を問わず、いかなる保証もありません。このソフトウェアはライセンスの下で配布され、ライセンスの条件に明示的に許可されている場合を除き、コピー、変更、または配布してはなりません。ライセンシング情報については、<a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a>でライセンス情報を参照するか、アメリカ合衆国カリフォルニア州サンフランシスコのArtifex Software Inc. までお問い合わせください。"

           }
       }

       return str;
   }

   document.getElementById("findOnDiscord").innerHTML = getHeaderAndFooterTranslation("Find <b>#pymupdf</b> on <b>Discord</b>");
   document.getElementById("feedbackLinkTop").innerHTML = getHeaderAndFooterTranslation("Do you have any feedback on this page?");
   document.getElementById("feedbackLinkBottom").innerHTML = getHeaderAndFooterTranslation("Do you have any feedback on this page?");
   document.getElementById("footerDisclaimer").innerHTML = getHeaderAndFooterTranslation("This software is provided AS-IS with no warranty, either express or implied. This software is distributed under license and may not be copied, modified or distributed except as expressly authorized under the terms of that license. Refer to licensing information at <a href='https://www.artifex.com?utm_source=rtd-pymupdf&utm_medium=rtd&utm_content=footer-link'>artifex.com</a> or contact Artifex Software Inc., 39 Mesa Street, Suite 108A, San Francisco CA 94129, United States for further information.");


   // more translation for admonition-title as the in-built translation isn't great, needs: 注釈 -> 注
   if (docLanguage == "ja") {
       const collection = document.getElementsByClassName("admonition-title");
       for (var i=0;i<collection.length;i++) {
           collection[i].innerHTML = "注";
       }
   }


</script><p class="footer-version">This documentation covers all versions up to 1.25.3.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="textpage.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">TextPage</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="shape.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Shape</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2015-2025, Artifex
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on 10. Mar 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Story</a><ul>
<li><a class="reference internal" href="#Story"><code class="docutils literal notranslate"><span class="pre">Story</span></code></a><ul>
<li><a class="reference internal" href="#Story.__init__"><code class="docutils literal notranslate"><span class="pre">Story.__init__()</span></code></a></li>
<li><a class="reference internal" href="#Story.place"><code class="docutils literal notranslate"><span class="pre">Story.place()</span></code></a></li>
<li><a class="reference internal" href="#Story.draw"><code class="docutils literal notranslate"><span class="pre">Story.draw()</span></code></a></li>
<li><a class="reference internal" href="#Story.element_positions"><code class="docutils literal notranslate"><span class="pre">Story.element_positions()</span></code></a></li>
<li><a class="reference internal" href="#Story.reset"><code class="docutils literal notranslate"><span class="pre">Story.reset()</span></code></a></li>
<li><a class="reference internal" href="#Story.body"><code class="docutils literal notranslate"><span class="pre">Story.body</span></code></a></li>
<li><a class="reference internal" href="#Story.write"><code class="docutils literal notranslate"><span class="pre">Story.write()</span></code></a></li>
<li><a class="reference internal" href="#Story.write_stabilized"><code class="docutils literal notranslate"><span class="pre">Story.write_stabilized()</span></code></a></li>
<li><a class="reference internal" href="#Story.write_with_links"><code class="docutils literal notranslate"><span class="pre">Story.write_with_links()</span></code></a></li>
<li><a class="reference internal" href="#Story.write_stabilized_with_links"><code class="docutils literal notranslate"><span class="pre">Story.write_stabilized_with_links()</span></code></a></li>
<li><a class="reference internal" href="#Story.FitResult"><code class="docutils literal notranslate"><span class="pre">Story.FitResult</span></code></a></li>
<li><a class="reference internal" href="#Story.fit"><code class="docutils literal notranslate"><span class="pre">Story.fit()</span></code></a></li>
<li><a class="reference internal" href="#Story.fit_scale"><code class="docutils literal notranslate"><span class="pre">Story.fit_scale()</span></code></a></li>
<li><a class="reference internal" href="#Story.fit_height"><code class="docutils literal notranslate"><span class="pre">Story.fit_height()</span></code></a></li>
<li><a class="reference internal" href="#Story.fit_width"><code class="docutils literal notranslate"><span class="pre">Story.fit_width()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#element-positioning-callback-function">Element Positioning CallBack function</a><ul>
<li><a class="reference internal" href="#attributes-of-the-elementposition-class">Attributes of the ElementPosition class</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=9ddcf537"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    </body>
</html>